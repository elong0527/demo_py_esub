---
title: "Baseline characteristics"
---

```{python}
import sys
import os
# Add the python-package directory to Python path for demo001 access
sys.path.insert(0, os.path.join(os.path.dirname(os.getcwd()), 'python-package'))

import polars as pl # Data manipulation
import rtflite as rtf # RTF reporting

# Import demo001 package functions
from demo001 import find_project_root, load_adam_dataset
from demo001.baseline import create_baseline_table
```

```{python}
#| echo: false
# Configure Polars to show only first 5 rows
pl.Config.set_tbl_rows(5)
```

## Step 1: Load Data

We start by loading the Subject-level Analysis Dataset (ADSL) and filtering to the safety population.

```{python}
# Load data using demo001 utility functions
project_root = find_project_root()
adsl = (
    load_adam_dataset("adsl", project_root)
    .select(["USUBJID", "TRT01P", "AGE", "SEX", "RACE"])
)

adsl
```

## Step 2: Create Baseline Characteristics Table

Using the demo001 package, we create a comprehensive baseline characteristics table with both continuous and categorical variables.

```{python}
# Define variables to include in baseline table
continuous_vars = ["AGE"]
categorical_vars = ["SEX", "RACE"]
treatments = ["Placebo", "Xanomeline Low Dose", "Xanomeline High Dose"]

# Create baseline table using demo001 functions
baseline_table = create_baseline_table(
    adsl=adsl,
    continuous_vars=continuous_vars,
    categorical_vars=categorical_vars,
    treatments=treatments
)

baseline_table
```

## Step 3: Generate Publication-Ready Output

Finally, we format the baseline table for regulatory submission using the `rtflite` package.

```{python}
# Get treatment group sizes for column headers
treatment_n = adsl.group_by("TRT01P").len().sort("TRT01P")
n_placebo = treatment_n.filter(pl.col("TRT01P") == "Placebo")["len"][0]
n_low = treatment_n.filter(pl.col("TRT01P") == "Xanomeline Low Dose")["len"][0]
n_high = treatment_n.filter(pl.col("TRT01P") == "Xanomeline High Dose")["len"][0]

doc_baseline = rtf.RTFDocument(
    df=baseline_table,
    rtf_title=rtf.RTFTitle(
        text=[
            "Baseline Characteristics of Participants", 
            "(All Participants Randomized)"
        ]
    ),
    rtf_column_header=rtf.RTFColumnHeader(
        text=[
            "Characteristic",
            f"Placebo\n(N={n_placebo})",
            f"Xanomeline Low Dose\n(N={n_low})",
            f"Xanomeline High Dose\n(N={n_high})"
        ],
        text_justification=["l", "c", "c", "c"],
        col_rel_width=[3, 2, 2, 2]
    ),
    rtf_body=rtf.RTFBody(
        text_justification=["l", "c", "c", "c"],
        col_rel_width=[3, 2, 2, 2]
    ),
    rtf_source=rtf.RTFSource(text=["Source: ADSL dataset"])
)

doc_baseline.write_rtf(project_root / "output" / "tlf_baseline.rtf")
```